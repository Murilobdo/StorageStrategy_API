<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/StorageStrategy.Data/Context/StorageDbContext.cs">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/StorageStrategy.Data/Context/StorageDbContext.cs" />
              <option name="originalContent" value="using Isopoh.Cryptography.Argon2;&#10;using Microsoft.EntityFrameworkCore;&#10;using Microsoft.Extensions.Options;&#10;using StorageStrategy.Data.Mappings;&#10;using StorageStrategy.Models;&#10;using StorageStrategy.Utils.Services;&#10;&#10;namespace StorageStrategy.Data.Context&#10;{&#10;    public class StorageDbContext : DbContext&#10;    {&#10;        private readonly IOptions&lt;AppSettings&gt; _appSettings;&#10;        &#10;        public StorageDbContext(DbContextOptions&lt;StorageDbContext&gt; options, IOptions&lt;AppSettings&gt; appSettings) : base(options)&#10;        {&#10;            _appSettings = appSettings;&#10;        }&#10;&#10;        public DbSet&lt;ClientEntity&gt; Client { get; set; }&#10;        public DbSet&lt;CategoryEntity&gt; Category { get; set; }&#10;        public DbSet&lt;ProductEntity&gt; Product { get; set; }&#10;        public DbSet&lt;CompanyEntity&gt; Company { get; set; }&#10;        public DbSet&lt;EmployeeEntity&gt; Employee { get; set; }&#10;        public DbSet&lt;CommandEntity&gt; Command { get; set; }&#10;        public DbSet&lt;CommandItemEntity&gt; CommandItems { get; set; }&#10;        public DbSet&lt;ExpenseEntity&gt; Expenses { get; set; }&#10;        public DbSet&lt;ExpensesTypeEntity&gt; ExpensesType { get; set; }&#10;        public DbSet&lt;StockHistoryEntity&gt; StockHistory { get; set; }&#10;        public DbSet&lt;StockHistoryItemEntity&gt; StockHistoryItems { get; set; }&#10;        public DbSet&lt;PaymentMethodEntity&gt; PaymentMethod { get; set; }&#10;        public DbSet&lt;LogApp&gt; Logs { get; set; }&#10;&#10;        protected override void OnConfiguring(DbContextOptionsBuilder options)&#10;        {   &#10;            options.UseSqlServer(_appSettings.Value.Database);&#10;            base.OnConfiguring(options);&#10;        }&#10;&#10;        protected override void OnModelCreating(ModelBuilder modelBuilder)&#10;        {&#10;            CompanyEntity adminCompany = new(companyId: 1, name: &quot;Admin Company&quot;, description: &quot;Admin&quot;, &#10;                createAt: DateTime.Now, validate: DateTime.Now.AddYears(10));&#10;&#10;            &#10;            modelBuilder.Entity&lt;CompanyEntity&gt;().HasData(adminCompany);&#10;&#10;            modelBuilder.Entity&lt;EmployeeEntity&gt;().HasData(new EmployeeEntity {&#10;                EmployeeId = 1,&#10;                Name = &quot;Murilo Bernardes (Admin)&quot;,&#10;                Email = &quot;murilobdo@admin.com&quot;,&#10;                PasswordHash = Argon2.Hash(&quot;fib&quot;),&#10;                JobRole = EmployeeRole.Admin,&#10;                CompanyId = adminCompany.CompanyId,&#10;                Comission = 0,&#10;                IsActive = true&#10;            });&#10;&#10;            modelBuilder.ApplyConfiguration(new CompanyMapping());&#10;            modelBuilder.ApplyConfiguration(new ProductMapping());&#10;            modelBuilder.ApplyConfiguration(new CategoryMapping());&#10;            modelBuilder.ApplyConfiguration(new EmployeeMapping());&#10;            modelBuilder.ApplyConfiguration(new CommandMapping());&#10;            modelBuilder.ApplyConfiguration(new CommandItemMapping());&#10;            modelBuilder.ApplyConfiguration(new ExpenseMappgin());&#10;            modelBuilder.ApplyConfiguration(new ExpensesTypeMappgin());&#10;            modelBuilder.ApplyConfiguration(new StockHistoryMapping());&#10;            modelBuilder.ApplyConfiguration(new StockHistoryItemMapping());&#10;            modelBuilder.ApplyConfiguration(new LogMapping());&#10;            modelBuilder.ApplyConfiguration(new PaymentMapping());&#10;            modelBuilder.ApplyConfiguration(new ClientMapping());&#10;            modelBuilder.ApplyConfiguration(new PaymentMethodMapping());&#10;            base.OnModelCreating(modelBuilder);&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="using Isopoh.Cryptography.Argon2;&#10;using Microsoft.EntityFrameworkCore;&#10;using Microsoft.Extensions.Options;&#10;using StorageStrategy.Data.Mappings;&#10;using StorageStrategy.Models;&#10;using StorageStrategy.Utils.Services;&#10;using System.Threading.Tasks;&#10;using System.Linq;&#10;&#10;namespace StorageStrategy.Data.Context&#10;{&#10;    public class StorageDbContext : DbContext&#10;    {&#10;        private readonly IOptions&lt;AppSettings&gt; _appSettings;&#10;        &#10;        public StorageDbContext(DbContextOptions&lt;StorageDbContext&gt; options, IOptions&lt;AppSettings&gt; appSettings) : base(options)&#10;        {&#10;            _appSettings = appSettings;&#10;        }&#10;&#10;        public DbSet&lt;ClientEntity&gt; Client { get; set; }&#10;        public DbSet&lt;CategoryEntity&gt; Category { get; set; }&#10;        public DbSet&lt;ProductEntity&gt; Product { get; set; }&#10;        public DbSet&lt;CompanyEntity&gt; Company { get; set; }&#10;        public DbSet&lt;EmployeeEntity&gt; Employee { get; set; }&#10;        public DbSet&lt;CommandEntity&gt; Command { get; set; }&#10;        public DbSet&lt;CommandItemEntity&gt; CommandItems { get; set; }&#10;        public DbSet&lt;ExpenseEntity&gt; Expenses { get; set; }&#10;        public DbSet&lt;ExpensesTypeEntity&gt; ExpensesType { get; set; }&#10;        public DbSet&lt;StockHistoryEntity&gt; StockHistory { get; set; }&#10;        public DbSet&lt;StockHistoryItemEntity&gt; StockHistoryItems { get; set; }&#10;        public DbSet&lt;PaymentMethodEntity&gt; PaymentMethod { get; set; }&#10;        public DbSet&lt;LogApp&gt; Logs { get; set; }&#10;&#10;        protected override void OnConfiguring(DbContextOptionsBuilder options)&#10;        {   &#10;            options.UseSqlServer(_appSettings.Value.Database);&#10;            base.OnConfiguring(options);&#10;        }&#10;&#10;        protected override void OnModelCreating(ModelBuilder modelBuilder)&#10;        {&#10;            // Removed HasData seeding for admin company and admin user.&#10;            // Seeding is handled at runtime by SeedDefaultAdminAsync so the company and user are created only if they don't exist.&#10;&#10;            modelBuilder.ApplyConfiguration(new CompanyMapping());&#10;            modelBuilder.ApplyConfiguration(new ProductMapping());&#10;            modelBuilder.ApplyConfiguration(new CategoryMapping());&#10;            modelBuilder.ApplyConfiguration(new EmployeeMapping());&#10;            modelBuilder.ApplyConfiguration(new CommandMapping());&#10;            modelBuilder.ApplyConfiguration(new CommandItemMapping());&#10;            modelBuilder.ApplyConfiguration(new ExpenseMappgin());&#10;            modelBuilder.ApplyConfiguration(new ExpensesTypeMappgin());&#10;            modelBuilder.ApplyConfiguration(new StockHistoryMapping());&#10;            modelBuilder.ApplyConfiguration(new StockHistoryItemMapping());&#10;            modelBuilder.ApplyConfiguration(new LogMapping());&#10;            modelBuilder.ApplyConfiguration(new PaymentMapping());&#10;            modelBuilder.ApplyConfiguration(new ClientMapping());&#10;            modelBuilder.ApplyConfiguration(new PaymentMethodMapping());&#10;            base.OnModelCreating(modelBuilder);&#10;        }&#10;&#10;        // Call this method at application startup after obtaining a scope with StorageDbContext.&#10;        // It will create the default admin company and user only if they are not already present in the database.&#10;        public async Task SeedDefaultAdminAsync()&#10;        {&#10;            // Ensure admin company exists&#10;            if (!await Company.AnyAsync(c =&gt; c.Name == &quot;Admin Company&quot;))&#10;            {&#10;                var adminCompany = new CompanyEntity(companyId: 1, name: &quot;Admin Company&quot;, description: &quot;Admin&quot;, &#10;                    createAt: DateTime.Now, validate: DateTime.Now.AddYears(10));&#10;                Company.Add(adminCompany);&#10;                await SaveChangesAsync();&#10;            }&#10;&#10;            var company = await Company.FirstAsync(c =&gt; c.Name == &quot;Admin Company&quot;);&#10;&#10;            // Ensure admin employee exists&#10;            if (!await Employee.AnyAsync(e =&gt; e.Email == &quot;murilobdo@admin.com&quot;))&#10;            {&#10;                Employee.Add(new EmployeeEntity {&#10;                    EmployeeId = 1,&#10;                    Name = &quot;Murilo Bernardes (Admin)&quot;,&#10;                    Email = &quot;murilobdo@admin.com&quot;,&#10;                    PasswordHash = Argon2.Hash(&quot;fib&quot;),&#10;                    JobRole = EmployeeRole.Admin,&#10;                    CompanyId = company.CompanyId,&#10;                    Comission = 0,&#10;                    IsActive = true&#10;                });&#10;                await SaveChangesAsync();&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>